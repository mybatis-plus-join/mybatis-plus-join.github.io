import{_ as i,c as u,b as n,f as a,d as p,a as e,e as o,r as l,o as r}from"./app-Eaq0FEP2.js";const k={},d={id:"updatejoinandnull",tabindex:"-1"},m={class:"header-anchor",href:"#updatejoinandnull"},v={class:"hint-container warning"},b={class:"hint-container warning"},g={class:"hint-container warning"};function w(f,s){const c=l("Badge"),t=l("RouteLink");return r(),u("div",null,[s[17]||(s[17]=n("h1",{id:"连表更新-更新空字段",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#连表更新-更新空字段"},[n("span",null,"连表更新(更新空字段)")])],-1)),n("h2",d,[n("a",m,[n("span",null,[s[0]||(s[0]=a("updateJoinAndNull ")),p(c,{type:"tip",text:"1.4.5+",vertical:"top"})])])]),s[18]||(s[18]=e(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 根据 whereEntity 条件，更新记录</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token parameter">entity</span>  实体对象 (set 条件值,可以为 null)</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token parameter">wrapper</span> 实体对象封装操作类（可以为 null,里面的 entity 用于生成 where 语句）</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">int</span> <span class="token function">updateJoinAndNull</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">,</span><span class="token class-name">MPJBaseJoin</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="wrapper设置set语句和where条件" tabindex="-1"><a class="header-anchor" href="#wrapper设置set语句和where条件"><span>wrapper设置set语句和where条件</span></a></h2><p>这种方式和 updateJoin 方法没有区别, 因为set语句实体为null</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">MpJoinTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Resource</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * 手动set条件</span>
<span class="line">     * 更新 user表name字段和address表address字段</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">UpdateJoinWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserDO</span><span class="token punctuation">&gt;</span></span> update <span class="token operator">=</span> <span class="token class-name">JoinWrappers</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">UserDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">UserDO</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">,</span> <span class="token string">&quot;aaaaaa&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AddressDO</span><span class="token operator">::</span><span class="token function">getAddress</span><span class="token punctuation">,</span> <span class="token string">&quot;bbbbb&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">leftJoin</span><span class="token punctuation">(</span><span class="token class-name">AddressDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">AddressDO</span><span class="token operator">::</span><span class="token function">getUserId</span><span class="token punctuation">,</span> <span class="token class-name">UserDO</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">UserDO</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">int</span> i <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">updateJoinAndNull</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对应sql</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">UPDATE</span></span>
<span class="line">    <span class="token identifier"><span class="token punctuation">\`</span>user<span class="token punctuation">\`</span></span> t</span>
<span class="line">    <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> address t1</span>
<span class="line"><span class="token keyword">ON</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>user_id <span class="token operator">=</span> t<span class="token punctuation">.</span>id<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">SET</span> t<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>name<span class="token punctuation">\`</span></span><span class="token operator">=</span>?<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>address<span class="token operator">=</span>?</span>
<span class="line"><span class="token keyword">WHERE</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>id <span class="token operator">=</span> ?<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="根据实体更新-wrapper作为where条件" tabindex="-1"><a class="header-anchor" href="#根据实体更新-wrapper作为where条件"><span>根据实体更新, wrapper作为where条件</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">MpJoinTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Resource</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * 根据实体更新, wrapper作为where条件</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//主表实体 用于生成 set 语句</span></span>
<span class="line">        <span class="token class-name">UserDO</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUpdateBy</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">UpdateJoinWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserDO</span><span class="token punctuation">&gt;</span></span> update <span class="token operator">=</span> <span class="token class-name">JoinWrappers</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">UserDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">leftJoin</span><span class="token punctuation">(</span><span class="token class-name">AddressDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">AddressDO</span><span class="token operator">::</span><span class="token function">getUserId</span><span class="token punctuation">,</span> <span class="token class-name">UserDO</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">UserDO</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">int</span> i <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">updateJoinAndNull</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对应<strong>log</strong> 更新user全部字段(包括空字段)</p><div class="language-log line-numbers-mode" data-highlighter="prismjs" data-ext="log" data-title="log"><pre><code><span class="line"><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span>  Preparing<span class="token operator">:</span> UPDATE \`user\` t LEFT JOIN address t1 ON <span class="token operator">(</span>t1<span class="token punctuation">.</span>user_id <span class="token operator">=</span> t<span class="token punctuation">.</span>id<span class="token operator">)</span> SET t<span class="token punctuation">.</span>pid<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>\`name\`<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>\`json\`<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>sex<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>head_img<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>create_time<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>address_id<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>address_id2<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>create_by<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>update_by<span class="token operator">=</span><span class="token operator">?</span> WHERE <span class="token operator">(</span>t<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">)</span></span>
<span class="line"><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> <span class="token boolean">null</span><span class="token punctuation">,</span> aaa<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">(</span>Integer<span class="token operator">)</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span>    Updates<span class="token operator">:</span> <span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,10)),n("div",v,[s[6]||(s[6]=n("p",{class:"hint-container-title"},"注意事项:",-1)),n("p",null,[s[2]||(s[2]=a("实体类更新")),s[3]||(s[3]=n("strong",null,"所有字段( 包括空字段 )",-1)),s[4]||(s[4]=a(", 如果要只更新非空字段")),s[5]||(s[5]=n("br",null,null,-1)),p(t,{to:"/pages/core/api/updateJoin.html"},{default:o(()=>s[1]||(s[1]=[a("参考"),n("strong",null,"updateJoin",-1),a("方法")])),_:1})])]),s[19]||(s[19]=e(`<h2 id="主表根据实体更新-副表手动设置set语句" tabindex="-1"><a class="header-anchor" href="#主表根据实体更新-副表手动设置set语句"><span>主表根据实体更新, 副表手动设置set语句</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">MpJoinTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Resource</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * 根据实体更新, wrapper作为where条件</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//主表实体 用于生成 set 语句</span></span>
<span class="line">        <span class="token class-name">UserDO</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUpdateBy</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">UpdateJoinWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserDO</span><span class="token punctuation">&gt;</span></span> update <span class="token operator">=</span> <span class="token class-name">JoinWrappers</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">UserDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token comment">//设置副表 set 语句</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AddressDO</span><span class="token operator">::</span><span class="token function">getAddress</span><span class="token punctuation">,</span> <span class="token string">&quot;bbbbb&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">leftJoin</span><span class="token punctuation">(</span><span class="token class-name">AddressDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">AddressDO</span><span class="token operator">::</span><span class="token function">getUserId</span><span class="token punctuation">,</span> <span class="token class-name">UserDO</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">UserDO</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">int</span> i <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">updateJoinAndNull</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对应log</p><div class="language-log line-numbers-mode" data-highlighter="prismjs" data-ext="log" data-title="log"><pre><code><span class="line"><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span>  Preparing<span class="token operator">:</span> UPDATE \`user\` t LEFT JOIN address t1 ON <span class="token operator">(</span>t1<span class="token punctuation">.</span>user_id <span class="token operator">=</span> t<span class="token punctuation">.</span>id<span class="token operator">)</span> SET t<span class="token punctuation">.</span>pid<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>\`name\`<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>\`json\`<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>sex<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>head_img<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>create_time<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>address_id<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>address_id2<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>create_by<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>update_by<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t1<span class="token punctuation">.</span>address<span class="token operator">=</span><span class="token operator">?</span> WHERE <span class="token operator">(</span>t<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">)</span></span>
<span class="line"><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> <span class="token boolean">null</span><span class="token punctuation">,</span> aaa<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span> bbbbb<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">(</span>Integer<span class="token operator">)</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span>    Updates<span class="token operator">:</span> <span class="token number">10</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4)),n("div",b,[s[10]||(s[10]=n("p",{class:"hint-container-title"},"注意事项:",-1)),n("p",null,[s[8]||(s[8]=a("实体类只更新非空字段, 如果要更新全部字段(非空字段和空字段)")),s[9]||(s[9]=n("br",null,null,-1)),p(t,{to:"/pages/core/api/updateJoinAndNull.html"},{default:o(()=>s[7]||(s[7]=[a("参考"),n("strong",null,"updateJoinAndNull",-1),a("方法")])),_:1})])]),s[20]||(s[20]=e(`<h2 id="根据主表和副表实体类更新-wrapper作为where条件" tabindex="-1"><a class="header-anchor" href="#根据主表和副表实体类更新-wrapper作为where条件"><span>根据主表和副表实体类更新, wrapper作为where条件</span></a></h2><p>这里提两个方法</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">//更新实体非空字段</span></span>
<span class="line"><span class="token punctuation">.</span><span class="token function">setUpdateEntity</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> entityList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//更新实体空字段和非空字段</span></span>
<span class="line"><span class="token punctuation">.</span><span class="token function">setUpdateEntityAndNull</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> entityList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">MpJoinTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Resource</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * 场景: </span>
<span class="line">     * 三表联查并且按照实体更新这三张表</span>
<span class="line">     * 主表 user 副表 address 和 area</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//主表类 用于生成 set 语句</span></span>
<span class="line">        <span class="token class-name">UserDO</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUpdateBy</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//两个关联表 用于生成 set 语句</span></span>
<span class="line">        <span class="token class-name">AddressDO</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AddressDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setTel</span><span class="token punctuation">(</span><span class="token string">&quot;119&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;人民广场&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">AreaDO</span> area <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AreaDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setProvince</span><span class="token punctuation">(</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCity</span><span class="token punctuation">(</span><span class="token string">&quot;北京!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">UpdateJoinWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserDO</span><span class="token punctuation">&gt;</span></span> update <span class="token operator">=</span> <span class="token class-name">JoinWrappers</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">UserDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token comment">//设置两个副表的 set 语句</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">setUpdateEntity</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> area<span class="token punctuation">)</span></span>
<span class="line">                <span class="token comment">//address和area 两张表空字段和非空字段一起更新 可以改成如下setUpdateEntityAndNull</span></span>
<span class="line">                <span class="token comment">//.setUpdateEntityAndNull(address, area)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">leftJoin</span><span class="token punctuation">(</span><span class="token class-name">AddressDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">AddressDO</span><span class="token operator">::</span><span class="token function">getUserId</span><span class="token punctuation">,</span> <span class="token class-name">UserDO</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">leftJoin</span><span class="token punctuation">(</span><span class="token class-name">AreaDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">AreaDO</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token class-name">AddressDO</span><span class="token operator">::</span><span class="token function">getAreaId</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">UserDO</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">int</span> i <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">updateJoinAndNull</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对应log</p><div class="language-log line-numbers-mode" data-highlighter="prismjs" data-ext="log" data-title="log"><pre><code><span class="line"><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span>  Preparing<span class="token operator">:</span> UPDATE \`user\` t LEFT JOIN address t1 ON <span class="token operator">(</span>t1<span class="token punctuation">.</span>user_id <span class="token operator">=</span> t<span class="token punctuation">.</span>id<span class="token operator">)</span> LEFT JOIN area t2 ON <span class="token operator">(</span>t2<span class="token punctuation">.</span>id <span class="token operator">=</span> t1<span class="token punctuation">.</span>area_id<span class="token operator">)</span> SET t<span class="token punctuation">.</span>pid<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>\`name\`<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>\`json\`<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>sex<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>head_img<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>create_time<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>address_id<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>address_id2<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>create_by<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>update_by<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> t1<span class="token punctuation">.</span>tel<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span>t1<span class="token punctuation">.</span>address<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span>t2<span class="token punctuation">.</span>province<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span>t2<span class="token punctuation">.</span>city<span class="token operator">=</span><span class="token operator">?</span> WHERE <span class="token operator">(</span>t<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">)</span></span>
<span class="line"><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> <span class="token boolean">null</span><span class="token punctuation">,</span> aaa<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span> 人民广场<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span> 北京<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span> 北京<span class="token operator">!</span><span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">(</span>Integer<span class="token operator">)</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span>    Updates<span class="token operator">:</span> <span class="token number">19</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6)),n("div",g,[s[16]||(s[16]=n("p",{class:"hint-container-title"},"注意事项:",-1)),n("p",null,[s[12]||(s[12]=a("实体类更新")),s[13]||(s[13]=n("strong",null,"所有字段( 包括空字段 )",-1)),s[14]||(s[14]=a(", 如果要只更新非空字段")),s[15]||(s[15]=n("br",null,null,-1)),p(t,{to:"/pages/core/api/updateJoin.html"},{default:o(()=>s[11]||(s[11]=[a("参考"),n("strong",null,"updateJoin",-1),a("方法")])),_:1})])])])}const y=i(k,[["render",w],["__file","updateJoinAndNull.html.vue"]]),O=JSON.parse('{"path":"/pages/core/api/updateJoinAndNull.html","title":"连表更新(更新空字段)","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"updateJoinAndNull","slug":"updatejoinandnull","link":"#updatejoinandnull","children":[]},{"level":2,"title":"wrapper设置set语句和where条件","slug":"wrapper设置set语句和where条件","link":"#wrapper设置set语句和where条件","children":[]},{"level":2,"title":"根据实体更新, wrapper作为where条件","slug":"根据实体更新-wrapper作为where条件","link":"#根据实体更新-wrapper作为where条件","children":[]},{"level":2,"title":"主表根据实体更新, 副表手动设置set语句","slug":"主表根据实体更新-副表手动设置set语句","link":"#主表根据实体更新-副表手动设置set语句","children":[]},{"level":2,"title":"根据主表和副表实体类更新, wrapper作为where条件","slug":"根据主表和副表实体类更新-wrapper作为where条件","link":"#根据主表和副表实体类更新-wrapper作为where条件","children":[]}],"git":{"updatedTime":1724150898000,"contributors":[{"name":"yulichang","email":"570810310@qq.com","commits":2}]},"filePathRelative":"pages/core/api/updateJoinAndNull.md"}');export{y as comp,O as data};
